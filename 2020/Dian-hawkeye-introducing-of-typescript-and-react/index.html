<!DOCTYPE html><html lang="zh-CN"><head hexo-theme="https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1"><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="preload" href="/css/first.css" as="style"><title>组会分享：TypeScript &amp; React 简单入门 - 七海の参考書</title><meta name="keywords" content="课内作业,Web,Dian,React,TypeScript"><meta name="description" content="Dian 团队鹰眼组的组会分享，因为不知道说什么就只好说一说之前工程实训做的一些事情了，也算是对之前一些实践的总结吧（日，写文章属实要命……"><link rel="alternate" href="/atom.xml" title="七海の参考書" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/ymd45921/util_assets@master/favicon/ymd45921/madoka-1/favicon.ico"><link href="https://cdn.jsdelivr.net/gh/45921/cdn-font@main/Kyokasho/UDDigiKyokashoNP-R/cdn.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Noto+Serif+SC:wght@300&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;1,300;1,400&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://gh.shiraha.cn/cdn-public/css/blog/main.min.css"><link rel="stylesheet" href="https://gh.shiraha.cn/cdn-public/css/blog/dark.min.css"><link rel="stylesheet" href="https://gh.shiraha.cn/cdn-public/css/blog/cmsg.min.css"><link rel="stylesheet" href="/css/first.css"><link rel="stylesheet" href="/css/style.css" media="print" onload='this.media="all",this.onload=null'><noscript><link rel="stylesheet" href="/css/style.css"></noscript><script>window.MSInputMethodContext&&document.documentMode&&document.write('<style>html{overflow-x: hidden !important;overflow-y: hidden !important;}.kill-ie{text-align:center;height: 100%;margin-top: 15%;margin-bottom: 5500%;}</style><div class="kill-ie"><h1><b>抱歉，您的浏览器无法访问本站</b></h1><h3>微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</h3><br/><a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/WindowsForBusiness/End-of-IE-support"><strong>了解详情 ></strong></a></div>')</script><noscript><style>html{overflow-x:hidden!important;overflow-y:hidden!important}.kill-noscript{text-align:center;height:100%;margin-top:15%;margin-bottom:5500%}</style><div class="kill-noscript"><h1><b>抱歉，您的浏览器无法访问本站</b></h1><h3>本页面需要浏览器支持（启用）JavaScript</h3><br> <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a></div></noscript></head><body><header id="l_header" class="l_header auto shadow blur" style="opacity:0"><div class="container"><div id="wrapper"><div class="nav-sub"><p class="title"></p><ul class="switcher nav-list-h m-phone" id="pjax-header-nav-list"><li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href="javascript:void(0)"></a></li><li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href="javascript:void(0)"></a></li></ul></div><div class="nav-main"> <a class="title flat-box" target="_self" href="/">七海の参考書</a><div class="menu navigation"><ul class="nav-list-h m-pc"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id="home"><i class="fad fa-home fa-fw"></i> 主页</a></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-rss fa-fw"></i> 文章</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fad fa-folder-open fa-fw"></i> 分类</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fad fa-tags fa-fw"></i> 标签</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fad fa-archive fa-fw"></i> 归档</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/favorite/" id="favorite"><i class="fad fa-bookmark fa-fw"></i> 收藏</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-cube fa-fw"></i> 应用</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="https://pages.shiraha.cn/gallery/" id="https:pagesshirahacngallery"><i class="fad fa-flower-tulip fa-fw"></i> 黄油画廊</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://pages.shiraha.cn/periodic-table/" id="https:pagesshirahacnperiodic-table"><i class="fad fa-atom-alt fa-fw"></i> 元素周期表</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://bejeweled.shiraha.cn/" id="https:bejeweledshirahacn"><i class="fad fa-gem fa-fw"></i> 宝石迷阵</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://music.shiraha.moe/" id="https:musicshirahamoe"><i class="fad fa-cloud-music fa-fw"></i> 网易云音乐</a></li><hr><li><a class="menuitem flat-box header toggle-mode-btn"><i class="fad fa-moon-stars fa-fw"></i> 暗黑模式</a></li><li></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-link fa-fw"></i> 链接</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fad fa-heartbeat fa-fw"></i> 朋友</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/artitalk/" id="artitalk"><i class="fad fa-comment-dots fa-fw"></i> 说说</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/navigation/" id="navigation"><i class="fad fa-compass fa-fw"></i> 导航</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/toys/" id="toys"><i class="fad fa-toolbox fa-fw"></i> 小玩具</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://valine.shiraha.cn/" id="https:valineshirahacn"><i class="fad fa-tasks fa-fw"></i> 评论后台</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://shiraha.moe/" id="https:shirahamoe"><i class="fad fa-books fa-fw"></i> 咕咕ing..</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fad fa-info-circle fa-fw"></i> 关于</a></li></ul></div><div class="m_search"><form name="searchform" class="form u-search-form"><i class="icon fas fa-search fa-fw"></i> <input type="text" class="input u-search-input" placeholder="你想要找什么呢？"></form></div><ul class="switcher nav-list-h m-phone"><li><a class="s-search fas fa-search fa-fw" target="_self" href="javascript:void(0)"></a></li><li><a class="s-menu fas fa-bars fa-fw" target="_self" href="javascript:void(0)"></a><ul class="menu-phone list-v navigation white-box"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id="home"><i class="fad fa-home fa-fw"></i> 主页</a></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-rss fa-fw"></i> 文章</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fad fa-folder-open fa-fw"></i> 分类</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fad fa-tags fa-fw"></i> 标签</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fad fa-archive fa-fw"></i> 归档</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/favorite/" id="favorite"><i class="fad fa-bookmark fa-fw"></i> 收藏</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-cube fa-fw"></i> 应用</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="https://pages.shiraha.cn/gallery/" id="https:pagesshirahacngallery"><i class="fad fa-flower-tulip fa-fw"></i> 黄油画廊</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://pages.shiraha.cn/periodic-table/" id="https:pagesshirahacnperiodic-table"><i class="fad fa-atom-alt fa-fw"></i> 元素周期表</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://bejeweled.shiraha.cn/" id="https:bejeweledshirahacn"><i class="fad fa-gem fa-fw"></i> 宝石迷阵</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://music.shiraha.moe/" id="https:musicshirahamoe"><i class="fad fa-cloud-music fa-fw"></i> 网易云音乐</a></li><hr><li><a class="menuitem flat-box header toggle-mode-btn"><i class="fad fa-moon-stars fa-fw"></i> 暗黑模式</a></li><li></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-link fa-fw"></i> 链接</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fad fa-heartbeat fa-fw"></i> 朋友</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/artitalk/" id="artitalk"><i class="fad fa-comment-dots fa-fw"></i> 说说</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/navigation/" id="navigation"><i class="fad fa-compass fa-fw"></i> 导航</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/toys/" id="toys"><i class="fad fa-toolbox fa-fw"></i> 小玩具</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://valine.shiraha.cn/" id="https:valineshirahacn"><i class="fad fa-tasks fa-fw"></i> 评论后台</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://shiraha.moe/" id="https:shirahamoe"><i class="fad fa-books fa-fw"></i> 咕咕ing..</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fad fa-info-circle fa-fw"></i> 关于</a></li></ul></li></ul></div></div></div></header><div id="l_body"><div id="l_cover"><div id="half" class="cover-wrapper post dock" style=""><div id="parallax-window"></div><div class="cover-body"><div class="top"><p class="title">七つの海</p><p class="subtitle">今日、海を見た。もう怖くない</p></div><div class="bottom"><div class="menu navigation"><div class="list-h"> <a href="/" id="home"><img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c2.svg"><p>博客</p></a> <a href="/memo/" id="memo"><img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1fab6.svg"><p>随笔</p></a> <a href="/friends/" id="friends"><img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f37b.svg"><p>朋友</p></a> <a href="/archives/" id="archives"><img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4da.svg"><p>归档</p></a> <a href="/about/" id="about"><img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4a1.svg"><p>关于</p></a></div></div></div></div><div id="scroll-down" style="display:none"><i class="fa fa-chevron-down scroll-down-effects"></i></div></div></div><div id="safearea"><div class="body-wrapper" id="pjax-container"><div id="l_main" class=""><article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost"><div class="article-meta" id="top"><h1 class="title"> 组会分享：TypeScript & React 简单入门</h1><div class="new-meta-box"><div class="new-meta-item author"> <a class="author" href="https://shiraha.cn" rel="nofollow"><img no-lazy src="https://cdn.jsdelivr.net/gh/45921/cdn-images@main/avatar/sena.shiratama.jpg"><p>七海</p></a></div><div class="new-meta-item category"><a class="notlink"><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i> <a class="category-link" href="/categories/Web/">Web</a><span class="sep"></span><a class="category-link" href="/categories/Web/%E5%89%8D%E7%AB%AF/">前端</a></a></div><div class="new-meta-item date"><a class="notlink"><i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i><p>发布于：2020年7月14日</p></a></div><div class="new-meta-item browse leancloud"><a class="notlink"><div id="lc-pv" data-title="组会分享：TypeScript & React 简单入门" data-path="/2020/Dian-hawkeye-introducing-of-typescript-and-react/"><i class="fas fa-eye fa-fw" aria-hidden="true"></i><span id="number"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次浏览</div></a></div></div></div><p>在目前主流的三大前端框架中，React 应该是和 TypeScript 联系最为紧密的；TypeScript 已经可以完美的融入到 React 的工具链中，所以若需要开发现代的、整洁的 React 应用， TypeScript 不可或缺；</p><p>此外，在 React 工具链中，React-Router 和 React-Redux 是重要的部分，它们也对 TypeScript 有很好的支持；这篇文章将结合刚过去不久的工程实训，谈谈我在使用 TypeScript + React 工具链的一些想法和实践；</p><h2 id="typescript-入门">TypeScript 入门</h2><p>有道：学习一门语言的最好方法是看它的<a target="_blank" rel="noopener" href="https://www.tslang.cn/">官方文档</a>；</p><p>下面仅简单的介绍一些可以用的到的东西：</p><h3 id="建立项目">建立项目</h3><p>考虑到你组项目常用 React + antd 组合，所以可以通过执行下面命令创建：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app antd-demo-ts --template typescript</span><br><span class="line"><span class="comment"># ↑ yarn || npm ↓</span></span><br><span class="line">npx create-react-app antd-demo-ts --typescript</span><br></pre></td></tr></table></figure><p>均使用 <strong>CRA</strong> 创建样板项目，具体的配置被隐藏，一般需要 <code>eject</code> 后才可以修改；</p><p>虽然理论上需要使用 <code>tsc</code> 将 TypeScript 代码编译成 js 代码，但是这些事情都已经被脚手架集成了，所以在 React 项目中不用考虑这些事情。</p><p>需要注意的是，很多 node 模块默认是不包含 TypeScript 支持的；当你需要向一个 TypeScript 工程中引入某个模块时，不仅需要安装这个模块，还需要安装它的类型声明文件，就像这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router-dom @types/react-router-dom</span><br><span class="line"><span class="comment"># ↑ yarn || npm ↓</span></span><br><span class="line">npm install react-router-dom @types/react-router-dom</span><br></pre></td></tr></table></figure><p>否则，IDE 将会因为找不到类型声明文件而报错，或提示你没有安装对应的包。</p><h3 id="类型标识">类型标识</h3><p>TypeScript 和 JavaScript 的核心区别；即使 React.js 可以通过 jsdoc 或者 proptype 进行类型检查和 IDE 指导，但是均没有 TypeScript 原生的类型检查来的优雅自然：</p><blockquote><p>jsDoc：受有限的支持，在部分 IDE 中甚至不会有语法高亮；仅能在有限的环境中提供 IDE 建议，而不是强制的语法保证；毕竟本质上只是注释。</p><p>propType：是运行时的类型检查，并不能在编译期间提供任何指引。</p></blockquote><p>类型标识的格式：<code>变量名 / 参数名 / 类域名 : 类型标识符</code>，这些声明和 JavaScript 所在位置一样。</p><p>类型标识符包括 JavaScript Object 类型和由库定义的类型；浏览器，网页对象模型中的类型已经在 React 中定义好，也可以直接使用：</p><table><colgroup><col style="width:20%"><col style="width:80%"></colgroup><thead><tr class="header"><th>组别</th><th>标识符</th></tr></thead><tbody><tr class="odd"><td>JSON</td><td><code>number</code>, <code>string</code>, <code>object</code>, <code>any</code>, <code>null</code>, <code>undefined</code>, <code>boolean</code>, <code>&lt;class&gt;[]</code>, <code>void</code></td></tr><tr class="even"><td>TypeScript 特有</td><td><code>never</code>：表示的是永不存在的值的类型<br><code>any</code>：表示任何类型，TypeScript 将放弃类型检查</td></tr><tr class="odd"><td>函数</td><td><code>(param: any) =&gt; void</code>：括号中是参数类型，需要指定参数名，但只对比参数类型</td></tr><tr class="even"><td>用户定义的类型</td><td>使用 <code>interface</code> 关键字定义的类型和 <code>type</code> 关键字定义的类型</td></tr><tr class="odd"><td>React 常见类型</td><td><code>React.Component&lt;P,S&gt;</code>：组件类，P 是 props 类型，S 是 state 类型<br><code>JSX.Element</code>：JSX 标签类型，可以作为组件的返回值<br><code>React.CSSProperties</code>：描述了 style 的对象，连字符被更换成了驼峰命名法<br><code>React.&lt;...&gt;Event</code>：代表各种 HTML 事件的类型，如 change 和 keyboard 等</td></tr></tbody></table><p>在 TypeScript 中，声明变量的类型如果不能由上下文自动推导，将提示错误：即你需要在任何不能推断类型的地方使用类型标识规定类型才能使得代码通过编译；</p><h3 id="类型运算">类型运算</h3><p>比起其他强类型语言类型的麻烦，TypeScript 提供了灵活的类型运算；我们称其结果为<strong>类型谓词</strong>：</p><table><colgroup><col style="width:17%"><col style="width:82%"></colgroup><thead><tr class="header"><th>关键字</th><th>含义</th></tr></thead><tbody><tr class="odd"><td><code>typeof</code></td><td>获得其后跟随的变量类型，具体如下：<br>- 跟随普通变量将获得变量的类型<br>- 跟随字符串将获得字符串字面量的类型<br>- 跟随对象将获得包含对象中所有属性的类型<br>- 跟随<strong>箭头函数</strong>将获得该函数的类型签名<br>这个表达式运行的结果是类型谓词。</td></tr><tr class="even"><td><code>interface</code></td><td>类似 C 中的结构体（下文简称），声明包含特定属性的对象的类型谓词；</td></tr><tr class="odd"><td><code>type</code></td><td>用来声明类型（谓词）或者类型别名；它可以接受：<br>- 一个类型谓词的赋值，形如 <code>typeof xxx</code><br>- 使用 <code>|</code> 或 <code>&amp;</code> 运算符组合的类型，形如 <code>string | number</code><br>- 接受字符串/数字字面量类型，形如 <code>'big' | 'small'</code><br>格式为 <code>type MyType = &lt;类型谓词&gt;</code>，接下来你可以使用 <code>MyType</code> 了；</td></tr><tr class="even"><td><code>Partial&lt;T&gt;</code></td><td>T 为结构体，得到 T 所有域均为可选的类型谓词</td></tr><tr class="odd"><td><code>Required&lt;T&gt;</code></td><td>T 为结构体，得到 T 所有域均为必须的类型谓词</td></tr><tr class="even"><td><code>Nullable&lt;T&gt;</code></td><td>T 为结构体，得到 T 所有域均为可空的类型谓词</td></tr></tbody></table><p>↑↑ 后三个这种“类型”还有很多，出现在 <code>typescript/lib/lib.es5.d.ts</code> 的 1440 行左右，可以去看（</p><p>声明 <code>interface</code> 时，可以对成员变量标志后增加 <code>?</code> 来表明它是可选的，也可以在标志前增加 <code>readonly</code> 来表明它是只读的；比如你可以这样声明一个 “结构体”：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">    username: <span class="built_in">string</span>;</span><br><span class="line">    avatar: <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">readonly</span> password?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当你只需要一个 <code>interface</code> 中的部分属性的时候（比如后端通信），就可以使用 <code>Partial&lt;User&gt;</code> 来获得这样的类型；</p><h3 id="在-react-中使用">在 React 中使用</h3><p>React 现在有两种写法：一种是比较经典的 class 写法，还有一种是比较新的 React Hook 写法；它们均能和 TypeScript 较好的联动，增加代码的整洁程度：</p><h4 id="class-写法">class 写法</h4><p>首先，我们继承的 <code>React.Component</code> 的定义是 <code>React.Component&lt;P, S&gt;</code>；两个泛型参数分别制定了 props 类型和 state 类型，因此我们在创建一个组件时，需要先定义该组件的 props 和 state 的类型谓词；因为它们都是一个对象，所以我们使用 <code>interface</code> 定义它们的类型；一般遵循如下格式：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component, CSSProperties&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">    style?: Partial&lt;CSSProperties&gt;;</span><br><span class="line">    className?: <span class="built_in">string</span>;</span><br><span class="line">    children?: JSX.Element | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IState &#123;</span><br><span class="line">    data: <span class="built_in">object</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> App <span class="keyword">extends</span> Component&lt;IProps, IState&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">props: IProps</span>) &#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            data: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render(): JSX.Element &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;className, style&#125; = <span class="built_in">this</span>.props;</span><br><span class="line">        <span class="keyword">return</span> &lt;div className=&#123;className&#125; style=&#123;style ?? &#123;&#125;&#125;&gt;</span><br><span class="line">            &#123;<span class="built_in">this</span>.props.children&#125;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大体和 JavaScript 一致，只是增加了类型标识；需注意非箭头方法仍然需要 this 绑定；</p><h4 id="react-hook-写法">React Hook 写法</h4><p>其实只是函数式组件的写法，和 Hook 相关的内容暂时扯不上太多关系：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;CSSProperties, FC, memo, useState&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">    style?: Partial&lt;CSSProperties&gt;;</span><br><span class="line">    className?: <span class="built_in">string</span>;</span><br><span class="line">    children?: JSX.Element | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;IProps&gt; = memo(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> [data, setData] = useState(&#123;&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &lt;div className=&#123;className&#125; style=&#123;style ?? &#123;&#125;&#125;&gt;</span><br><span class="line">        &#123;<span class="built_in">this</span>.props.children&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>只是当组件需要持有状态时，采用 <code>useState</code> 钩子创建即可；下面列出了一些常用 Hook：</p><table><colgroup><col style="width:14%"><col style="width:14%"><col style="width:71%"></colgroup><thead><tr class="header"><th>Hook</th><th>来源</th><th>作用</th></tr></thead><tbody><tr class="odd"><td><code>useState</code></td><td>React</td><td>为当前的函数组件增加一个状态；返回一个包含状态和修改函数的数组；</td></tr><tr class="even"><td><code>useContext</code></td><td>React</td><td>在 Provider 下使用，获取其提供的共享 Context 对象；</td></tr><tr class="odd"><td><code>useEffect</code></td><td>React</td><td>用于取代 class 型组件的生命周期方法：<br>它接受两个参数：一个回调函数（异步）和一个包含依赖项的数组；<br>当依赖项发生变化时，它会调用回调函数；<br>省略第二个参数：每次重新渲染时调用回调函数；<br>第二个参数为空：仅第一次渲染时调用回调函数</td></tr><tr class="even"><td><code>useReducer</code></td><td>React</td><td>和 <code>useState</code> 类似；接受 Reducer 函数和初始状态作为参数；</td></tr><tr class="odd"><td><code>useHistory</code></td><td>React-Router</td><td>在路由组件下使用，获得该路由依据的 History 对象，可用于跳转页面；</td></tr></tbody></table><p>但是 TypeScript 的强大之处并没有体现出来，当和 Redux 一起使用，组件的类型不能够明晰的分辨出时，TypeScript 所提供的类型提示的作用才可以真正反映出来；</p><h2 id="redux-入门">Redux 入门</h2><p>Redux 是前端的一个中心化数据管理的框架；它将一些组件中需要重复使用的数据提取出来，存储到一个统一的位置供组件拿取；并通过统一的预定义的行为对存储的数据进行修改，从而达成了数据流可控；在 React 中，Redux 通过 React 组件的上下文来实现；</p><p>本部分进行简单的 Redux 概念介绍，并结合 React Hook 和 TypeScript 构建代码：</p><h3 id="概念介绍">概念介绍</h3><p>首先先介绍专有名词：</p><ul><li><strong>Store</strong>：即存储，中心化状态管理体系中数据存储的地方；对于 React 等现代前端框架而言，每个 SPA 仅持有 <strong>1 个</strong>；它是一个树状结构，可以用对象的形式表示；</li><li><strong>Action</strong>：即行为，用来修改 store 中存储的状态；一般来说，它是一个<strong>对象</strong>，包含这个 Action 是什么以及执行这个行为所需要的数据；</li><li><strong>Reducer</strong>：用来处理 Action，是一个<strong>函数</strong>；它接受 store 的上一个状态和 Action，返回新的 store 状态；它是一个<strong>纯函数</strong>，且定义了 store 的结构；</li><li><strong>Action Creator</strong>：即行为创造器，它可以接受必须的信息，用来生成一个符合要求的 Action 对象，是一个函数；</li></ul><p>实际上，Redux 的工作流程可以概括为下图：</p><figure> <img src="https://cdn.jsdelivr.net/gh/ymd45921/util_assets@master/post/web-frontend-react/Redux.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/ymd45921/util_assets@master/post/web-frontend-react/Redux.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="流程图"><figcaption aria-hidden="true">流程图</figcaption></figure><p>由 Action Creator 创造的 Action 对象可以通过 <code>store.dispatch()</code> 方法分发给 Store，Store 根据 Action 的类型（即这是什么行为）将它交给对应的 Reducer 计算出新的状态进行更新；</p><p>和 Store 的树形结构一样，Reducer 也是树形结构——可包含多个子 Reducer，和 Store 一一对应；Store 的树形结构来自 JavaScript 对象的嵌套，Reducer 的树形结构来自于多个子 Reducer 的合并；一般写法如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> StoreState &#123;</span><br><span class="line">    user: UserStore;</span><br><span class="line">    homepage: HomepageStore;</span><br><span class="line">    component: ComponentStore;</span><br><span class="line">    category: CategoryStore;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducers = combineReducers(&#123;</span><br><span class="line">    user: userReducer,</span><br><span class="line">    homepage: homepageReducer,</span><br><span class="line">    component: componentReducer,</span><br><span class="line">    category: categoryReducer,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> enhancer = composeWithDevTools(AsyncMiddleware);</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducers, enhancer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC = memo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">		&lt;/&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上面代码中的 <code>XxxStore</code> 和 <code>xxxReducer</code> 分别是子 Store 和子 reducer，唯一的根 Store 即由合并得到的根 Reducer 生成的 <code>store</code>；<code>enhancer</code> 是增强件，可以用来强化 Redux 的功能；上图的 ”Async Middleware“ 就是其中一种，这里先不细说；创建的 Store 需要使用 Provider 提供给虚拟 DOM 某节点下所有的节点，这里通过 React 的上下文来实现；</p><p><code>composeWithDevTools</code> 来自 node 模块 <code>redux-devtools-extension</code>；它可以和 Chrome 同名插件配合使用，输出 Action 对 Redux Store 的更改轨迹，并随时查看 Store 中存储的值；它也属于 enhancer 的一种，建议使用；</p><h3 id="关于-react-redux">关于 React-Redux</h3><p>可以看到，Redux 这种设计模式适用于任何根据数据渲染组件的前端框架，这当然包括 React；React-Redux 的出现代替了上面提到的“订阅/通知”，而采用一种更加自然的方式帮助我们完成了这项工作。</p><p>在说这个之前先说一种在 React 中非常常见的设计模式：</p><blockquote> #####<center> 有状态组件和无状态组件</center><p>顾名思义，状态指 React 中的 state；有状态组件不仅需要参与页面渲染，还需要包含逻辑来维护它自身所持有的状态；而无状态组件仅根据父组件传进来的 props 渲染视图；</p><p>软件设计中有一个原则，叫做“责任分离”：即让一个模块的责任尽量少；当模块负责的内容过多，应当将模块进行拆分，以使得每一个模块尽可能专注一个事务，以方便后续维护。</p><p>显然，渲染视图和维护状态的逻辑并不是一项功能，特别是当逻辑复杂时，会导致很大的组件——这对于后期项目维护来说是致命的；一种显然的解决措施就是将维护状态逻辑和渲染视图分离，即将一个“传统组件”拆分成有状态组件（即“容器”）和无状态组件（即“视图”）；</p><p>首先，渲染视图和逻辑并不沾边，这样的分割是合理的；其次，这样做可以方便的更换数据管理的方式：比如有状态组件从 Redux 获取数据；也可以方便的更换数据的展示方式，这样做均只需要修改对应的组件即可，避免了对代码的大规模改动。</p></blockquote><p>如果我们要在项目中使用 Redux，显然视图组件的数据来源是 Redux，我们应当使用这种设计模式；但是这方面的工作 React-Redux 已经帮我们做好了，我们只需要专注视图组件的展示即可；React-Redux 提供了方便的 API 实现 Store 中数据和视图状态的双向绑定：</p><ul><li><strong>mapStateToProps</strong>：将 Store 中储存的状态双向绑定到组件的 Props，从而组件可以通过 Props 获得渲染视图所需要的状态；它的类型声明是 <code>(state: Store) =&gt; object</code>；</li><li><strong>mapDispatchToProps</strong>：将 Store 接受的 Action 的 Creator 通过 Props 传递给组件；Action 是改变 Store 状态唯一的途径，组件可以通过这些方法产生需要的 Action 并且自动分发到 Store；</li><li><strong>connect</strong>：接受上面的两个用户定义的方法和视图组件，自动生成一个该视图组件的容器组件；这个容器组件可以读取 Store 中特定的数据并交给视图组件渲染，并在必要时触发 Action；</li></ul><p>简单的说，就是用户提供用于渲染视图的无状态组件，以及该组件需要进行的 Action，也就是逻辑，由 React-Redux 负责生成对应组件的容器；用户无需进行具体的组件状态管理，只需要定义 Action 和编写视图组件；在所有需要使用到该组件的场合使用 React-Redux 自动生成的组件即可；</p><h3 id="使用-redux">使用 Redux</h3><p>使用 React 的好处不言而喻；状态的更改有迹可循，组件并不需要维持很多状态就可以渲染视图，整个项目的逻辑更加的清晰自然；但是缺点也是显而易见的——将所有的操作定义为 Action 将产生大量的”无用代码“，增加了项目的代码量和复杂程度；React 自身也有优秀的状态管理，如果完全使用 Redux 作为状态管理，也是对 React 的功能的一种浪费；因此要做到有的放矢，才是最佳实践：</p><ul><li>被多个 React 组件共享的状态需要放进 Redux</li><li>组件重新装载，仍然需要持有之前的状态时需要放进 Redux</li><li>否则，这个状态就放在 React 组件中好了</li></ul><p>通过上面的方法可以判断一个状态是否要放进 Redux 中；对于放进 Redux 状态，我们仍然需要遵循一些”公理“，来使得代码的逻辑更加的合理：</p><ul><li>Redux 中的数据应当是范式化的 ”Raw Data“</li><li>通过 selector 将处理后的数据传送给组件</li><li>只有少量的关键组件 connect 了 Redux Store</li></ul><p>Selector 相当于 Vue 中的计算属性 computed：它以 Store 中存储的一些数据为基础，记忆化的存储计算结果，且仅在这些数据源发生改变时才重新计算；比起 React 每次使用数据都进行重复计算要更加高效；Selector 本质上只是接受状态的函数，包含计算出容器所需要的数据的逻辑；它可复用，且一般在 mapStateToProps 中使用；</p><h3 id="处理异步事件">处理异步事件</h3><p>如果仅使用前面提到的 Redux，我们需要为一个异步事件确定三个 Action：它们分别在异步事件开始时、异步事件 Fulfilled 和 Rejected 的情况下被触发；对应 Promise 的 resolve 和 reject；如果这些操作都在需要执行异步请求的组件中手动调用，将造成大量的重复代码，不可取；但是 Redux 的设计要求 Action 只能是同步的，我们并不能想当然的将一个异步事件做成一个 Action；此时就需要异步中间件了。</p><p>异步中间件仍然需要定义多个 Action，但是它将根据异步请求的结果自动地调用后续 Action，减少了代码重复；同时，异步 Action 遵循了 Redux 的标准，它对状态的修改也是可追溯的；常用的异步中间件如下：</p><ul><li><strong>Redux-thunk</strong>：简单易上手，但功能有限；它会在第一个 Action 发出之后，自动地发出第二个 Action 用异步获取的数据来更新状态；</li><li><strong>Redux-observable</strong>：基于 RxJS 的 <code>observer</code> 实现，功能强大，可以处理复杂的事件流，但是学习门槛较高；</li><li><strong>Redux-Saga</strong>：基于 JavaScript Generator 语法，介于上述两者之间；下文将着重介绍它的使用；</li></ul><p>异步中间件属于对于 Redux 的拓展，在创建 store 时需要将需要的中间件放在上文代码 <code>enhancer</code> 的位置；</p><h4 id="中间件原理">中间件原理</h4><p>分析 Redux 的工作流程，Reducer 和 Action 是纯函数和纯对象，并不能进行改动；再参考上面说的没有中间件的情况下异步 Action 的方法，考虑到我们需要在 Action 分发的过程中增加中间件来自动完成一些工作；</p><p>中间件相当于一个改造过的 <code>store.dispatch</code>；dispatch 方法可以拿到行为和前状态，并且有和可以改变状态的 Reducer 通信的能力；如果我们需要做什么包含副作用的行为，在 dispatch 函数内最合适不过了；所谓中间件，就是按照 Redux 的标准对 dispatch 方法进行了一些改造，增强了它的功能；</p><p>比如 <code>redux-logger</code> 中间件，他会在收到前状态和行为时打印前状态，并且在和 Reducer 通信后打印新状态；又比如上面提到的 <code>redux-thunk</code> 中间件要求 Action Creator 返回一个异步请求执行前和执行后都会发起同步 Action 的函数；这种特别的 Action Craetor 产生的 Action 本不能被 dispatch 函数处理，但是中间件增强了它的功能，使得这种 Action 被中间件处理成可以自动发起第二个 Action 的效果；从而达到了异步通信的目的；</p><h3 id="使用-redux-saga">使用 Redux-Saga</h3><p>Redux-Saga 采用了 JavaScript 的生成器语法；它接管部分 Action，在收到 Action 时产生一个生成器对象，并且逐步执行其中的语句——这个过程保证了其内部语句执行的顺序；这个过程中可以发起新的 Action，由中间件自动完成；为了和普通的 Action 区分开来，我们将这部分被接管的 Action 称为 Saga；</p><h4 id="生成器语法">生成器语法</h4><p>首先先介绍大家都很熟悉的 <code>yield</code> 关键字：它在 C# 和 Python 中都存在<del>也即将出现在 C++ 2a</del>，在各领域（如 Unity 游戏编程）的协程中发挥作用；JavaScript / TypeScript 的 <code>yield</code> 和其它语言类似，如果理解的话就不用看下面了；</p><p>生成器函数使用 <code>function*</code> 声明，调用它将返回一个迭代器；每次调用迭代器都将执行到 <code>yield</code> 语句所在位置，并将该语句的值作为阶段性返回值返回，直到该函数中所有的语句都已经执行完毕；简单的说，<code>yield</code> 语句将会确保严格按照其顺序执行；</p><p>在 Redux-Saga 中，我们并不需要手动的去调用迭代器的 <code>next</code> 方法，中间件将会替我们完成；</p><h4 id="saga-的组成">Saga 的组成</h4><p>和定义 Action 类似，定义 Saga 依然需要包含四个部分；但是它们被 dispatch 后的处理方式不同：</p><p>一般的 Action 需要被 Reducer 接受并且利用 <code>switch</code> 语句计算新状态，而 Saga 需要被已注册的监视函数监听后，根据定义的并行策略调用生成器函数，并自动迭代；异步 Action 需要发起的其他 Action 均可以作为该生成器函数中可迭代的一步；</p><p>因此，对于一个 Saga，我们还需要额外定义它的监视函数（仅包含一个语句，决定了这个异步行为的策略）和它的生成器函数（包含了这个行为需要进行的异步操作逻辑），代码范例见下文代码范式；</p><h4 id="使用-saga">使用 Saga</h4><p>和普通的 Action 一样，将 Saga 的 Action Creator 通过 React-Redux 的 <code>mapDispatchToProps</code> 方法传递给组件即可；创造出的 Saga 会被注册的监听函数捕捉，并自动迭代生成器函数；</p><h3 id="代码范式">代码范式</h3><p>对于上一部分提到的一些名词，这里展示一些使用 TypeScript 编写的范式代码供参考：</p><h4 id="action-action-creator">Action &amp; Action Creator</h4><p>定义一个 Action 至少需要下面四个声明：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> LOGIN = <span class="string">&#x27;LOGIN&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> LOGIN = <span class="keyword">typeof</span> LOGIN;	<span class="comment">// 取字符串字面量作为此 Action 的类型标识</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Login &#123;</span><br><span class="line">    <span class="keyword">type</span>: LOGIN;					<span class="comment">// Action 的类型声明，必须包含 type 域</span></span><br><span class="line">    token: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">token: <span class="built_in">string</span></span>): <span class="title">Login</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="keyword">type</span>: LOGIN, token&#125;;	<span class="comment">// Action Creator 制造一个 Action 对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Action 标识字符串，Action 表示类型谓词，Action 对象的类型谓词和 Action Creator 函数；一般分别采用大写 + 下划线、大写 + 下划线、Pascal 命名法、驼峰命名法来命名；</p><h4 id="reducer">Reducer</h4><p>一个 Reducer 也许要包含下面四个部分：接受的 Action 类型，由它更新的子 store 的类型声明，这个子 store 的初始值以及 Reducer 函数；</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Action = actions.Login | actions.Logout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UserStore &#123;</span><br><span class="line">    token: <span class="built_in">string</span>;</span><br><span class="line">    info: User;</span><br><span class="line">    isLoading: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> init: UserStore = &#123;</span><br><span class="line">    token: <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>) ?? <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    info: &#123;&#125; <span class="keyword">as</span> User,</span><br><span class="line">    isLoading: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">userReducer</span>(<span class="params">state = init, action: Action</span>): <span class="title">UserStore</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> actions.LOGIN:</span><br><span class="line">            <span class="keyword">const</span> &#123;token&#125; = action;</span><br><span class="line">            <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;token&#x27;</span>, token);</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, token&#125;;</span><br><span class="line">        <span class="keyword">case</span> actions.LOGOUT:</span><br><span class="line">            <span class="built_in">localStorage</span>.removeItem(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> &#123;...userInit, token: <span class="string">&#x27;&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">default</span>: <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从外部导入已经定义好的 Action 对象类型谓词，并将该 Reducer 需要处理的 Action 类型通过类型运算符 <code>|</code> 合并起来，就是这个 Reducer 需要接受的 Action 类型的类型谓词；</p><p>Reducer 函数需要接受上一个 Store 的状态和要进行的 Action 对象，通过 <code>switch</code> 语句匹配 Action 标识类型并且进行对应的操作，计算出新对象返回；当上一个 Store 状态不存在时，填入初始值；</p><h4 id="react-redux">React-Redux</h4><p>下面的代码为视图组件 AppBar 创造了一个容器类：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;bindActionCreators, Dispatch&#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> AppBar <span class="keyword">from</span> <span class="string">&#x27;../components/AppBar&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state: StoreState</span>) =&gt;</span> (&#123;</span><br><span class="line">    loggedIn: <span class="function">(<span class="params">state</span>) =&gt;</span> !!state.user.token,	<span class="comment">// 一个简单的 selector	</span></span><br><span class="line">    userInfo: state.user,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch: Dispatch</span>) =&gt;</span> bindActionCreators(&#123;</span><br><span class="line">    updateToken: actions.login,</span><br><span class="line">    logout: actions.logout,</span><br><span class="line">&#125;, dispatch)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> StateProps = ReturnType&lt;<span class="keyword">typeof</span> mapStateToProps&gt;;</span><br><span class="line"><span class="keyword">type</span> DispatchProps = ReturnType&lt;<span class="keyword">typeof</span> mapDispatchToProps&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> AppBarProps = StateProps &amp; DispatchProps;	<span class="comment">// 作为 AppBar 视图组件的 IProps</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(AppBar);</span><br></pre></td></tr></table></figure><p>上述代码中提到的 <code>connect</code> 其实需要接受四个类型参数：<code>&lt;TStateProps = &#123;&#125;, TDispatchProps = &#123;&#125;, TOwnProps = &#123;&#125;, State = DefaultRootState&gt;</code>；但是因为可以类型推导以及默认值，所以这里没有写明：</p><ul><li><code>TStateProps</code>：由 <code>mapStateToProps</code> 带来的 props，上述代码中已经赋值给了 <code>StateProps</code>；</li><li><code>TDispatchProps</code>：由 <code>mapDispatchToProps</code> 带来的 props，上述代码中已经赋值给了 <code>DispatchProps</code>；</li><li><code>TOwnProps</code>：除了这些之外该组件需要的 props；比如需要传入路由参数时，该值应当为 <code>RouteComponentProps</code>；</li><li><code>State</code>：即原始 Store 的类型，已经通过默认值自动赋值了，一般不需要修改；</li></ul><p>当你要将路由参数传入容器时，不仅需要显式地传入类型参数 <code>RouteComponentProps</code>，还需要将组件使用 <code>withRouter</code> 方法处理；即：<code>export default withRouter(connect&lt;StateProps, DispatchProps, RouteComponentProps, StoreState&gt;(mapStateToProps, mapDispatchToProps)(AppBar));</code>；</p><h4 id="redux-saga">Redux-Saga</h4><p>和其他异步中间件一样，Redux-Saga 接管了部分 Action 的处理，我们称这些 Action 为 Saga；下面是定义一个 Saga 并且将它应用到 store 的代码样例：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;put, takeLatest, call, all&#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">&#x27;redux-saga&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">worker</span>(<span class="params">action: $actions.FetchInfoStart</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">yield</span> put(actions.processStarted());	<span class="comment">// 发起异步操作开始的 Action</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">yield</span> axios.get(api.me);	<span class="comment">// 调用异步 API</span></span><br><span class="line">        <span class="keyword">const</span> body = res.data;</span><br><span class="line">        <span class="keyword">if</span> (body.code &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> put(actions.InfoFetched(action.uid, body.data));	<span class="comment">// 发起更新数据的 Action</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">yield</span> <span class="built_in">console</span>.log(body.msg);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">yield</span> message.error(e.toString());		<span class="comment">// 可以发起 Reject 的第二个 Action</span></span><br><span class="line">        $history.push(url.$<span class="number">404</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">yield</span> put(actions.processHandled());	<span class="comment">// 发起 Fulfill 的第二个 Action</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">watcher</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> takeLatest($actions.FETCH_USER_INFO_START, worker);	<span class="comment">// 另有 takeEvery 代表允许并行</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sagas = [watcher];						<span class="comment">// 用来存放不同 saga 的 watcher</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span>* <span class="title">Sagas</span>(<span class="params"></span>) </span>&#123;						<span class="comment">// 注册所有的 saga</span></span><br><span class="line">    <span class="keyword">yield</span> all(sagas.map(<span class="function"><span class="params">saga</span> =&gt;</span> call(saga)));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> saga = createSagaMiddleware();</span><br><span class="line"><span class="keyword">const</span> AsyncMiddleware = applyMiddleware([saga]);</span><br><span class="line"><span class="keyword">const</span> enhancer = composeWithDevTools(AsyncMiddleware);		<span class="comment">// 组合 enhancer，引入 devtool</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducers, enhancer);				<span class="comment">// 创建 store</span></span><br><span class="line">saga.run(Sagas);											<span class="comment">// 启动 Redux-Saga</span></span><br></pre></td></tr></table></figure><p>代码中的 <code>takeLatest</code> 表示不允许并行，仅监听并执行最新的异步 Action；</p><h2 id="react-router-5.x">React-Router 5.x</h2><p>官方文档还停留在 3.0 版本，可是这玩意从 4.x 开始就已经和之前截然不同了；本部分的内容也无法解释很多，仅从个人使用的过程中总结一下经验和踩过的坑；</p><h3 id="安装">安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router react-router-dom @types/react-router @types/react-router-dom</span><br><span class="line"><span class="comment"># ↑ yarn || npm ↓</span></span><br><span class="line">npm install react-router react-router-dom @types/react-router @types/react-router-dom</span><br></pre></td></tr></table></figure><h3 id="组件">组件</h3><p>常用的组件包括三种：</p><ul><li>根组件（路由组件）：使用 history 模式的 <code>BrowserRouter</code> 和使用 hash 模式的 <code>HashRouter</code></li><li>路径匹配组件：可嵌套的路径组件 <code>Route</code> 和非嵌套的 <code>Switch</code> 组件；</li><li>导航跳转：<code>Link</code> 组件和 <code>NavLink</code> 组件、<code>Redirect</code> 组件等；</li></ul><p>除非在静态服务器上部署使用 hash 路由，否则强烈建议使用基于 History 的 <code>BrowswerRouter</code>；</p><p>Route 组件接受的参数主要包括下面的内容：</p><table><thead><tr class="header"><th>props</th><th>含义</th></tr></thead><tbody><tr class="odd"><td><code>path: string</code></td><td>路由的路径；在没有 <code>exact</code> 标志时只匹配前缀，且按照从上到下的顺序匹配</td></tr><tr class="even"><td><code>exact: boolean</code></td><td>精准匹配标志；当包含此标志时，路径匹配将要求完全一致，但忽略末尾的 '/'</td></tr><tr class="odd"><td><code>component</code></td><td>渲染组件；当路径匹配成功时需要渲染的组件</td></tr><tr class="even"><td><code>render</code></td><td>渲染函数；当路径匹配成功时将调用此函数渲染视图，可用于 SPA 的懒加载</td></tr><tr class="odd"><td><code>children</code></td><td>可以是其他路由组件以组成嵌套路由；也可以只是一般的 JSX</td></tr></tbody></table><p>因为 React-Router 导航的 Web 应用本质是单页应用（SPA）；当应用包含过多信息时，第一次载入将会十分耗时；我们可以将一些暂时不需要渲染的页面（组件）延迟加载，从而缩短第一次加载所需要的时间，提升用户体验：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Homepage = lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../containers/pages/homepage&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> User = lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../containers/pages/user&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index: FC = memo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> load = <span class="function">(<span class="params">Component: JSX.Element</span>) =&gt;</span> (props: RouteComponentProps) =&gt; (</span><br><span class="line">        &lt;Container &#123;...props&#125;&gt;</span><br><span class="line">            &lt;Suspense fallback=&#123;&lt;Loading /&gt;&#125;&gt;</span><br><span class="line">                &#123;Component&#125;</span><br><span class="line">            &lt;/Suspense&gt;</span><br><span class="line">        &lt;/Container&gt;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route path=&#123;url.login&#125; exact component=&#123;Login&#125; /&gt;</span><br><span class="line">          &lt;Route path=&#123;url.register&#125; exact component=&#123;Register&#125; /&gt;</span><br><span class="line">          &lt;Route path=&#123;url.root&#125; exact render=&#123;load(&lt;Homepage /&gt;)&#125; /&gt;</span><br><span class="line">          &lt;Route path=&#123;url.user&#125; exact render=&#123;load(&lt;User /&gt;)&#125; /&gt;</span><br><span class="line">          &lt;Redirect to=&#123;url.$<span class="number">404</span>&#125;/&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在 <code>load</code> 方法中还可以自定义当按需加载的组件还在加载中时需要显示的内容：比如一个 Loading 的动画、一个进度条或者是骨架屏，显著提升用户体验；</p><h3 id="路由传参">路由传参</h3><p>在 TypeScript 中，路由传递的参数的类型谓词是 <code>RouteComponentProps</code>；如果你需要在一个组件中使用路由参数，你需要在导出该组件时使用 <code>withRouter</code> 方法将它包裹，并修改显式声明的 <code>IProps</code>；</p><p>传入 Route 参数之后，就可以通过 <code>match</code> 来获得匹配信息：比如通过 <code>match.params</code> 来获得路由参数；</p><h3 id="路由跳转">路由跳转</h3><p>有两种方法：经典的做法就是通过上面组件中的 <code>Link</code> 等导航组件进行跳转；当你使用 <code>BrowserRouter</code> 作为根路由组件时，你也可以在其子组件中通过 <code>useHistory</code> 钩子获得 History 对象，然后通过 <code>history.push</code> 方法进行路由跳转；需要注意的是 <code>useHistory</code> 是钩子，仅能在函数式 React 组件中使用；且当该组件渲染在跟路由组件外时，通过该钩子会得到 <code>undefined</code> 并且报错；</p><p>当然，上述做法都是需要在视图之内的地方才可以使用路由跳转的；如果你想要在视图之外的地方（比如异步逻辑层）进行路由跳转…… <strong>人不能，至少不应该</strong>。建议停下来思考有没有更好的实现方法；当然方法还是有的：比如在逻辑层使用 <code>ReactDOM.render</code> 在某个不可见的地方渲染一个 <code>Link</code> 组件，又或者让根组件使用外部的 history 对象；但是这样写出来一定是烂代码所以这里就不细说了。</p><h2 id="后记-总结">后记 &amp; 总结</h2><p>不是多少有技术含量的东西，但是属于读了一些还算整洁的 React 源代码的一些收获；按照这样的实践方法写出的代码确实要来的更加整洁；但是任何事情都没有绝对的最优实践：即使完全按照上面说到的这些写法来构筑代码，如果缺乏一个合理的设计，盲目追求“最佳实践”，最终只会适得其反。</p><p>虽然 Redux 提供了可追踪的状态管理，但是根据上面的代码范式也很容易知道，这是建立在大量繁杂的代码基础上的； 本质上 Redux 通过增加了额外的 Action 和 Reducer 代码来增强项目的可维护性，但是增加的代码是不是必要的</p><h3 id="参考资料">参考资料</h3><p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" class="uri">http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html</a><br> <a target="_blank" rel="noopener" href="https://www.tslang.cn/docs/home.html" class="uri">https://www.tslang.cn/docs/home.html</a><br> <a target="_blank" rel="noopener" href="https://juejin.im/book/5ba42844f265da0a8a6aa5e9/section/5ba4840f5188255c791b0008" class="uri">https://juejin.im/book/5ba42844f265da0a8a6aa5e9/section/5ba4840f5188255c791b0008</a><br> <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html" class="uri">http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html</a><br> <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" class="uri">http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html</a><br> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/samve/p/12435908.html" class="uri">https://www.cnblogs.com/samve/p/12435908.html</a><br> <a target="_blank" rel="noopener" href="https://redux-saga-in-chinese.js.org/" class="uri">https://redux-saga-in-chinese.js.org/</a><br> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Iterators_and_Generators" class="uri">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Iterators_and_Generators</a></p><div class="footer"><div class="copyright"><blockquote><p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p><p>本文永久链接是：<a href="https://shiraha.cn/2020/Dian-hawkeye-introducing-of-typescript-and-react/">https://shiraha.cn/2020/Dian-hawkeye-introducing-of-typescript-and-react/</a></p></blockquote></div></div><div class="article-meta" id="bottom"><div class="new-meta-box"><div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-07-14T07:13:17+00:00"><a class="notlink"><i class="fas fa-edit fa-fw" aria-hidden="true"></i><p>更新于：2020年7月14日</p></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E8%AF%BE%E5%86%85%E4%BD%9C%E4%B8%9A/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>课内作业</p></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/Web/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>Web</p></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/Dian/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>Dian</p></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/React/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>React</p></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/TypeScript/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>TypeScript</p></a></div><div class="new-meta-item share -mob-share-list"><div class="-mob-share-list share-body"> <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://shiraha.cn/2020/Dian-hawkeye-introducing-of-typescript-and-react/&title=组会分享：TypeScript & React 简单入门 - 七海の参考書&summary="><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://shiraha.cn/2020/Dian-hawkeye-introducing-of-typescript-and-react/&title=组会分享：TypeScript & React 简单入门 - 七海の参考書&summary="><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener" target="_blank" href="http://service.weibo.com/share/share.php?url=https://shiraha.cn/2020/Dian-hawkeye-introducing-of-typescript-and-react/&title=组会分享：TypeScript & React 简单入门 - 七海の参考書&summary="><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a></div></div></div></div><div class="prev-next"><a class="prev" href="/2020/nowcoder-2020-summer-multi-3/"><p class="title"><i class="fas fa-chevron-left" aria-hidden="true"></i>Nowcoder 2020 暑期多校训练 （3）</p><p class="content">这一轮比赛的题目明显比起之前要友好许多——至少在最后一刻都能让队友满载做题，甚至还能感觉到一丝时间不够用……这比起之前的比赛可以说是天大的进步了，不过这也都是因为题目友好；而且简单的能做的题目就...</p></a><a class="next" href="/2020/nowcoder-2020-summer-multi-2/"><p class="title">Nowcoder 2020 暑期多校训练 （2）<i class="fas fa-chevron-right" aria-hidden="true"></i></p><p class="content">比完看到群里一群 hack 老哥和暴躁老哥，萌新不敢说话（ 3FUEYCMFGCVMO_XE2OY.png 看着带佬们讨论，发现争议的 hack，卡常数，栈空间等问题都和我们没有关系…… 那...</p></a></div></article><article class="post white-box reveal shadow" id="comments"><p ct><i class="fas fa-comments"></i> 评论</p><div id="valine_container" class="valine_thread"><i class="fas fa-cog fa-spin fa-fw fa-2x"></i></div></article></div><aside id="l_side"><section class="widget toc-wrapper shadow desktop mobile" id="toc-div"><header><i class="fal fa-list fa-fw" aria-hidden="true"></i> <span class="name">本文目录</span></header><div class="content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#typescript-%E5%85%A5%E9%97%A8"><span class="toc-text">TypeScript 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E9%A1%B9%E7%9B%AE"><span class="toc-text">建立项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%A0%87%E8%AF%86"><span class="toc-text">类型标识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BF%90%E7%AE%97"><span class="toc-text">类型运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-text">在 React 中使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redux-%E5%85%A5%E9%97%A8"><span class="toc-text">Redux 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D"><span class="toc-text">概念介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-react-redux"><span class="toc-text">关于 React-Redux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-redux"><span class="toc-text">使用 Redux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%BC%82%E6%AD%A5%E4%BA%8B%E4%BB%B6"><span class="toc-text">处理异步事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-redux-saga"><span class="toc-text">使用 Redux-Saga</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%8C%83%E5%BC%8F"><span class="toc-text">代码范式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#react-router-5.x"><span class="toc-text">React-Router 5.x</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-text">组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-text">路由传参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC"><span class="toc-text">路由跳转</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0-%E6%80%BB%E7%BB%93"><span class="toc-text">后记 &amp; 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol></li></ol></div></section></aside><script>window.pdata={},pdata.ispage=!0,pdata.postTitle="组会分享：TypeScript &amp; React 简单入门",pdata.commentPath="",pdata.commentPlaceholder="";var l_header=document.getElementById("l_header");l_header.classList.remove("show");var cover_wrapper=document.querySelector("#l_cover .cover-wrapper"),scroll_down=document.getElementById("scroll-down");cover_wrapper.id="half",cover_wrapper.style.display="",scroll_down.style.display="none"</script></div><footer class="footer clearfix"><br><br><div class="aplayer-container"><meting-js theme="#E63C5E" autoplay="false" volume="0.7" loop="all" order="random" fixed="false" list-max-height="340px" server="netease" type="playlist" id="4920065600" list-folded="true"></meting-js></div><br><div class="social-wrapper"> <a href="/atom.xml" class="social flat-btn" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/020-rss.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/020-rss.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a href="https://github.com/ymd45921/" class="social flat-btn" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/029-github.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/029-github.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a href="https://t.me/ymd45921/" class="social flat-btn" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/045-telegram.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/045-telegram.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a href="https://dribbble.com/shiraha/" class="social flat-btn" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/005-dribbble.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/005-dribbble.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a href="https://twitter.com/nnm_shiraha/" class="social flat-btn" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/018-twitter.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/018-twitter.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a href="mailto:i@shiraha.cn" class="social flat-btn" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/041-addthis.svg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org@1.1/icon/1322024-social-media/041-addthis.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a></div><div><p>博客内容遵循 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p></div><div><div></div><div><p><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">皖ICP备2020015994号-2</a></p></div> 本站使用 <a href="https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1" target="_blank" class="codename">Volantis</a> 作为主题，总访问量为<span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次<div class="copyright"><p><a href="https://shiraha.cn/">Copyright © 2017-2021 白羽七海</a></p></div></footer><a id="s-top" class="fas fa-arrow-up fa-fw" href="javascript:void(0)"></a></div></div><div><script>function RunItem(){function t(t,e){this.name=e||t.name,this.run=()=>{try{t()}catch(t){console.log(t)}}}this.list=[],this.start=()=>{for(var t=0;t<this.list.length;t++)this.list[t].run()},this.push=(e,n)=>{var o=new t(e,n);this.list.push(o)}}function loadScript(t,e){setTimeout((function(){var n=document.getElementsByTagName("head")[0]||document.documentElement,o=document.createElement("script");o.setAttribute("type","text/javascript"),e&&(o.onload=e),o.setAttribute("src",t),n.appendChild(o)}))}window.volantis={},window.shiraha={},volantis.$={},volantis.pjax={},volantis.pjax.method={complete:new RunItem,error:new RunItem,send:new RunItem},volantis.pjax={...volantis.pjax,push:volantis.pjax.method.complete.push,error:volantis.pjax.method.error.push,send:volantis.pjax.method.send.push},volantis.dark={},volantis.dark.method={toggle:new RunItem},volantis.dark={...volantis.dark,push:volantis.dark.method.toggle.push};var loadCSS=function(t,e,n,o){var i,a=window.document,s=a.createElement("link");if(e)i=e;else{var r=(a.body||a.getElementsByTagName("head")[0]).childNodes;i=r[r.length-1]}var l=a.styleSheets;if(o)for(var d in o)o.hasOwnProperty(d)&&s.setAttribute(d,o[d]);s.rel="stylesheet",s.href=t,s.media="only x",function t(e){if(a.body)return e();setTimeout((function(){t(e)}))}((function(){i.parentNode.insertBefore(s,e?i:i.nextSibling)}));var u=function(t){for(var e=s.href,n=l.length;n--;)if(l[n].href===e)return t();setTimeout((function(){u(t)}))};function h(){s.addEventListener&&s.removeEventListener("load",h),s.media=n||"all"}return s.addEventListener&&s.addEventListener("load",h),s.onloadcssdefined=u,u(h),s}</script><script>loadCSS("https://cdn.jsdelivr.net/gh/volantis-x/cdn-fontawesome-pro@master/css/all.min.css"),loadCSS("https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css")</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script><script>function pjax_fancybox(){$(".md .gallery").find("img").each((function(){var a=document.createElement("a");$(a).attr("class","fancybox"),$(a).attr("pjax-fancybox",""),$(a).attr("href",$(this).attr("src")),$(this).attr("data-original")&&$(a).attr("href",$(this).attr("data-original")),$(a).attr("data-fancybox","images");var t="";$(this).attr("alt")&&($(a).attr("data-caption",$(this).attr("alt")),t=$(this).attr("alt"));var n=document.createElement("div");$(n).addClass("fancybox"),$(this).wrap(n);var o=document.createElement("span");$(o).addClass("image-caption"),$(o).text(t),$(this).after(o),$(this).wrap(a)})),$(".md .gallery").find("img").fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1,closeClick:!0,helpers:{overlay:{closeClick:!0}},buttons:["zoom","close"]})}function SCload_fancybox(){0!=$(".md .gallery").find("img").length&&(loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"),loadScript("https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js",pjax_fancybox))}function Pjax_SCload_fancybox(){void 0===$.fancybox?SCload_fancybox():pjax_fancybox()}$((function(){SCload_fancybox()})),volantis.pjax.push(Pjax_SCload_fancybox),volantis.pjax.send(()=>{void 0!==$.fancybox&&$.fancybox.close()},"fancybox")</script><div id="rightmenu-wrapper"><ul class="list-v rightmenu" id="rightmenu-content"><li class="navigation menuNavigation-Content"><a class="nav icon-only fix-cursor-default" onclick="history.back()"><i class="fal fa-arrow-left fa-fw"></i></a><a class="nav icon-only fix-cursor-default" onclick="history.forward()"><i class="fal fa-arrow-right fa-fw"></i></a><a class="nav icon-only fix-cursor-default" onclick="window.location.reload()"><i class="fal fa-redo fa-fw"></i></a><a class="nav icon-only fix-cursor-default" href="/"><i class="fal fa-home fa-fw"></i></a></li><li class="option menuOption-Content"><a class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copyText"><i class="fal fa-copy fa-fw"></i> 复制文本</a><a class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copyPaste"><i class="fal fa-paste fa-fw"></i> 粘贴文本</a><a class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copySelect"><i class="fal fa-object-ungroup fa-fw"></i> 全选文本</a><a class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copyCut"><i class="fal fa-cut fa-fw"></i> 剪切文本</a><a class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="openTab"><i class="fal fa-external-link-square-alt fa-fw"></i> 在新标签页打开</a><a class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copySrc"><i class="fal fa-image fa-fw"></i> 复制图片地址</a></li><li class="menuLoad-Content"><a class="vlts-menu fix-cursor-default" href="https://github.com/ymd45921/hexo-theme-ymd45921/" id="https:githubcomymd45921hexo-theme-ymd45921"><i class="fal fa-code-branch fa-fw"></i> 主题源码</a></li><hr class="menuLoad-Content"><li class="menuLoad-Content"><a class="vlts-menu fix-cursor-default" onclick='document.execCommand("print")'><i class="fal fa-print fa-fw"></i> 打印页面</a></li><li class="option menuOption-Content"><a class="vlts-menu fix-cursor-default toggle-mode-btn menu-Option" data-fn-type="menuDarkBtn"><i class="fal fa-moon fa-fw"></i> 开灯/关灯</a></li><hr class="menuLoad-Content"><li class="music name menuOption-Content"><p class="nav music-title fix-cursor-default"></p></li><li class="music ctrl"><a class="nav icon-only backward fix-cursor-default" onclick="aplayerBackward()"><i class="fa fa-step-backward fa-fw"></i></a><a class="nav icon-only toggle fix-cursor-default" onclick="aplayerToggle()"><i class="fa fa-play fa-fw"></i></a><a class="nav icon-only forward fix-cursor-default" onclick="aplayerForward()"><i class="fa fa-step-forward fa-fw"></i></a></li><li class="music volume"><a class="nav volume"><div class="aplayer-volume-bar-wrap"><div class="aplayer-volume-bar fix-cursor-pointer"><div class="aplayer-volume"></div><i class="left fa fa-volume-off fa-fw"></i><i class="right fa fa-volume-up fa-fw"></i></div></div></a></li></ul></div><script>$((function(){rightMenu.init()}));var rightMenu=function(e){const t={},n=document.getElementById("rightmenu-wrapper"),o=document.getElementById("rightmenu-content"),i=$(".menuLoad-Content"),c=($(".menuOption-Content"),$('.menu-Option[data-fn-type="menuDarkBtn"]')),r=$('.menu-Option[data-fn-type="copyText"]'),l=$('.menu-Option[data-fn-type="copyPaste"]'),a=$('.menu-Option[data-fn-type="copySelect"]'),d=$('.menu-Option[data-fn-type="copyCut"]'),s=$('.menu-Option[data-fn-type="copyHref"]'),u=$('.menu-Option[data-fn-type="copySrc"]'),h=$('.menu-Option[data-fn-type="openTab"]');return e.init=()=>{t.init(),t.initEvent()},t.init=()=>{r.hide(),a.hide(),l.hide(),d.hide(),s.hide(),u.hide(),h.hide()},t.initEvent=()=>{window.document.oncontextmenu=e=>e.ctrlKey||$(window).width()<=500?(t.hideMenu(),!0):t.popMenu(e),n.oncontextmenu=e=>(e.stopPropagation(),e.preventDefault(),!1);const e="fal fa-moon".slice(3)||"moon",o="fal fa-sun".slice(3)||"sun";c.on("click.rightMenu.setMenuDark",t=>{c.children().toggleClass(e),c.children().toggleClass(o)}),document.addEventListener("click",()=>{t.hideMenu()})},t.popMenu=e=>{let i=e.clientX,c=e.clientY,r=o.offsetWidth,l=o.offsetHeight,a=i+r>(document.documentElement.clientWidth||document.body.clientWidth)?i-r+10:i,d=c+l>(document.documentElement.clientHeight||document.body.clientHeight)?c-l+10:c;try{t.setMenuItem(e),n.style.left=a+"px",n.style.top=d+"px",n.style.display="block"}catch(e){return console.error(e),!0}return!1},t.setMenuItem=e=>{let n=!1;const o=e.target,c=window.getSelection().toString();if($(o).is("input")||$(o).is("textarea")){const e=$(o).val();e.length>0?(a.show(),a.one("click.rightMenu.copySelect",()=>{$(o).select()})):a.hide(),c?(d.show(),d.one("click.rightMenu.copyCut",()=>{const n=o.selectionStart,i=o.selectionEnd;t.copyString(c),$(o).val(e.substring(0,n)+e.substring(i,e.length)),o.selectionStart=n,o.selectionEnd=n,$(o).focus()})):d.hide(),t.readClipboard().then(e=>{e?(l.show(),l.off("click.rightMenu.cpoyPaste").one("click.rightMenu.cpoyPaste",()=>{t.insertAtCaret($(o),e)})):l.hide()}).catch(e=>{l.hide()})}else a.hide(),l.hide(),d.hide();const p=o.href;p?(n=!0,s.show(),h.show(),s.one("click.rightMenu.copyHref",()=>{t.copyString(p)}),h.one("click.rightMenu.openTab",()=>{window.open(p)})):(s.hide(),h.hide());const m=o.currentSrc;m?(n=!0,u.show(),u.one("click.rightMenu.copySrc",()=>{t.copyString(m)})):u.hide(),c?(n=!0,r.show(),r.one("click.rightMenu.cpoyText",()=>{t.copyString(c)})):r.hide(),n?i.hide():i.show(),volantis.APlayerLoaded&&checkAPlayer()},t.hideMenu=()=>{n.style.display="none"},t.copyString=e=>{const n=document.createElement("input");n.setAttribute("readonly","readonly"),document.body.appendChild(n),n.setAttribute("value",e),n.select(),document.execCommand("copy"),document.body.removeChild(n),t.hideMenu()},t.insertAtCaret=function(e,t){const n=e[0],o=n.selectionStart,i=n.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(o||"0"==o){var c=n.scrollTop;n.value=n.value.substring(0,o)+t+n.value.substring(i,n.value.length),e.focus(),n.selectionStart=o+t.length,n.selectionEnd=o+t.length,n.scrollTop=c}else e.value+=t,e.focus()},t.readClipboard=async()=>{const e=await navigator.permissions.query({name:"clipboard-read"});return"granted"===e.state||"prompt"===e.state?navigator.clipboard.readText().then(e=>e).catch(e=>Promise.reject(e)):Promise.reject(e)},e}(rightMenu||{})</script><script>const rootElement=document.documentElement,darkModeStorageKey="user-color-scheme",rootElementDarkModeAttributeName="data-user-color-scheme",setLS=(e,t)=>{localStorage.setItem(e,t)},removeLS=e=>{localStorage.removeItem(e)},getLS=e=>localStorage.getItem(e),getModeFromCSSMediaQuery=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",resetRootDarkModeAttributeAndLS=()=>{var e;rootElement.removeAttribute("data-user-color-scheme"),e=darkModeStorageKey,localStorage.removeItem(e)},validColorModeKeys={dark:!0,light:!0},applyCustomDarkModeSettings=e=>{const t=e||getLS(darkModeStorageKey);getCustomDarkMode(),t===getModeFromCSSMediaQuery()?resetRootDarkModeAttributeAndLS():validColorModeKeys[t]?rootElement.setAttribute("data-user-color-scheme",t):resetRootDarkModeAttributeAndLS()},invertDarkModeObj={dark:"light",light:"dark"},getCustomDarkMode=()=>{let e=getLS(darkModeStorageKey);if(validColorModeKeys[e])e=invertDarkModeObj[e];else{if(null!==e)return;e=invertDarkModeObj[getModeFromCSSMediaQuery()]}volantis.dark.mode="dark"==e?"light":"dark"},toggleCustomDarkMode=()=>{let e=getLS(darkModeStorageKey);if(validColorModeKeys[e])e=invertDarkModeObj[e];else{if(null!==e)return;e=invertDarkModeObj[getModeFromCSSMediaQuery()]}var t,o;return t=darkModeStorageKey,o=e,localStorage.setItem(t,o),e};volantis.dark.toggle=()=>{const e=toggleCustomDarkMode();applyCustomDarkModeSettings(e),volantis.dark.method.toggle.start()};var btn=$(".toggle-mode-btn","#wrapper,#rightmenu-wrapper");function bindToggleButton(){btn.on("click",volantis.dark.toggle)}applyCustomDarkModeSettings(),document.addEventListener("DOMContentLoaded",bindToggleButton),volantis.pjax.push(bindToggleButton),volantis.pjax.send(()=>{btn.unbind("click")},"toggle-mode-btn-unbind")</script><script>function loadIssuesJS(){0!=$(".md").find(".issues-api").length&&loadScript("/js/issues.js")}$((function(){loadIssuesJS()})),volantis.pjax.push(()=>{"undefined"==typeof IssuesAPI&&loadIssuesJS()},"IssuesJS")</script><script defer="defer" src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazyload",threshold:0},window.addEventListener("LazyLoad::Initialized",(function(n){window.lazyLoadInstance=n.detail.instance}),!1),document.addEventListener("DOMContentLoaded",(function(){lazyLoadInstance.update()})),document.addEventListener("pjax:complete",(function(){lazyLoadInstance.update()}))</script><script>window.FPConfig={delay:0,ignoreKeywords:[],maxRPS:5,hoverDelay:25}</script><script defer="defer" src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script>var clipboard=new ClipboardJS(".btn-copy",{target:function(e){return e.nextElementSibling}});function wait(e,i){window.setTimeout(e,i)}function pjax_initCopyCode(){if($(".highlight .code pre").length+$(".article pre code").length!=0){var e="";e+='<button class="btn-copy" data-clipboard-snippet="">',e+='<i class="fas fa-copy"></i><span>COPY</span>',e+="</button>",$(".highlight .code pre").before(e),$(".article pre code").before(e),clipboard.off("success").on("success",(function(e){let i=$(e.trigger);i.addClass("copied");let a=$(i.find("i"));a.removeClass("fa-copy"),a.addClass("fa-check-circle");let n=$(i.find("span"));n[0].innerText="COPIED",wait((function(){a.removeClass("fa-check-circle"),a.addClass("fa-copy"),n[0].innerText="COPY"}),2e3)})),clipboard.off("error").on("error",(function(e){e.clearSelection();let i=$(e.trigger);i.addClass("copy-failed");let a=$(i.find("i"));a.removeClass("fa-copy"),a.addClass("fa-times-circle");let n=$(i.find("span"));n[0].innerText="COPY FAILED",wait((function(){a.removeClass("fa-times-circle"),a.addClass("fa-copy"),n[0].innerText="COPY"}),2e3)}))}}$((function(){pjax_initCopyCode()})),volantis.pjax.push(pjax_initCopyCode)</script><script>let APlayerController=new Object;APlayerController.id="4920065600",APlayerController.volume="0.7",loadCSS("https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css"),loadScript("https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"),window.volantis.APlayerLoaded=0;var checkAPlayer=setInterval((function(){window.APlayer&&"block"==$("#safearea").css("display")&&(clearInterval(checkAPlayer),window.volantis.APlayerLoaded||window.MetingJSElement||(window.volantis.APlayerLoaded=1,loadScript("https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js")))}),100);loadScript("/js/aplayer.js");var checkMetings=setInterval((function(){if(document.querySelectorAll("meting-js")[0].aplayer&&document.querySelectorAll("meting-js")[0].aplayer.on){clearInterval(checkMetings);try{var e=document.querySelectorAll("meting-js");e.forEach((t,a)=>{var l=e[a].aplayer;l.on("play",(function(e){var t=l.list.index,a=l.list.audios[t].title,n=l.list.audios[t].artist;volantis.message("音乐通知","正在播放："+a+" - "+n,"success")})),l.on("pause",(function(e){var t=l.list.index,a=l.list.audios[t].title,n=l.list.audios[t].artist;volantis.message("音乐通知","暂停播放："+a+" - "+n,"success")})),l.on("error",(function(e){var t=l.list.index,a=l.list.audios[t].title;volantis.message("音乐通知","歌曲："+a+"加载失败~","warning")}))})}catch(e){}}}),100)</script><script src="https://cdn.jsdelivr.net/gh/45921/cdn-public@main/js/valine/min.js"></script><script>function emoji(i,e,a){return i+"/"+i+"-"+e+"."+a}for(var emojiMaps={},i=1;i<=54;i++)emojiMaps["tieba-"+i]=emoji("tieba",i,"png");for(i=1;i<=101;i++)emojiMaps["qq-"+i]=emoji("qq",i,"gif");for(i=1;i<=116;i++)emojiMaps["aru-"+i]=emoji("aru",i,"gif");for(i=1;i<=125;i++)emojiMaps["twemoji-"+i]=emoji("twemoji",i,"png");for(i=1;i<=4;i++)emojiMaps["weibo-"+i]=emoji("weibo",i,"png");function pjax_valine(){if(!document.querySelectorAll("#valine_container")[0])return;let i=pdata.commentPlaceholder||"快来评论吧~",e=pdata.commentPath;if(0==e.length){e=""||decodeURI(window.location.pathname)}(new Valine).init(Object.assign({path:null,placeholder:"快来评论吧~",appId:"S7ksKxxJhmpgf5GYxLYxgY8l-gzGzoHsz",appKey:"U2dgr4saurlVKbSbYNObCgcD",meta:["nick","mail","link"],requiredFields:["nick","mail"],enableQQ:!0,recordIP:!1,avatar:"robohash",pageSize:10,lang:"zh-cn",highlight:!0,mathJax:!1,js:"https://cdn.jsdelivr.net/gh/45921/cdn-public@main/js/valine/min.js"},{el:"#valine_container",path:e,placeholder:i,emojiCDN:"https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/",emojiMaps:emojiMaps}))}$((function(){pjax_valine()})),volantis.pjax.push(pjax_valine)</script><script defer="defer" src="https://cdn.jsdelivr.net/gh/45921/cdn-public@main/js/busuanzi/busuanzi.modified.mini.js" data-pjax></script><script src="/js/app.js"></script><script>const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/",ROOT="/".endsWith("/")?"/":"//";function listenSearch(){customSearch=new HexoSearch({imagePath:SearchServiceimagePath})}function setSearchService(){listenSearch()}$(".input.u-search-input").one("focus",(function(){loadScript("/js/search/hexo.js",setSearchService)}))</script><script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script><script type="text/javascript">$((function(){Waves.attach(".flat-btn",["waves-button"]),Waves.attach(".float-btn",["waves-button","waves-float"]),Waves.attach(".float-btn-light",["waves-button","waves-float","waves-light"]),Waves.attach(".flat-box",["waves-block"]),Waves.attach(".float-box",["waves-block","waves-float"]),Waves.attach(".waves-image"),Waves.init()}))</script><script src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2/js/comment_typing.js"></script><script defer="defer">const LCCounter={app_id:"u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI",app_key:"jfHtEKVE24j0IVCGHbvuFClp",custom_api_server:"",getRecord:(e,t,r)=>new Promise((function(n,i){e("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:t}))).then(e=>e.json()).then(({results:s,code:o,error:a})=>{if(401===o)throw a;if(s&&s.length>0){var l=s[0];n(l)}else e("post","/classes/Counter",{url:t,title:r,times:0}).then(e=>e.json()).then((e,t)=>{if(t)throw t;n(e)}).catch(e=>{console.error("Failed to create",e),i(e)})}).catch(e=>{console.error("LeanCloud Counter Error:",e),i(e)})})),increment:(e,t)=>new Promise((function(r,n){e("post","/batch",{requests:t}).then(e=>{if((e=e.json()).error)throw e.error;r(e)}).catch(e=>{console.error("Failed to save visitor count",e),n(e)})})),buildIncrement:e=>({method:"PUT",path:"/1.1/classes/Counter/"+e,body:{times:{__op:"Increment",amount:1}}}),validUV(){var e="LeanCloudUVTimestamp",t=localStorage.getItem(e);return!(t&&(new Date).getTime()-parseInt(t)<=864e5)&&(localStorage.setItem(e,(new Date).getTime().toString()),!0)},addCount(e){var t=[],r=[],n=document.querySelector("#lc-sv"),s=this.getRecord(e,"https://shiraha.cn/#lc-sv","Visits").then(e=>{r.push(this.buildIncrement(e.objectId));var t=document.querySelectorAll("#lc-sv #number");t.length>0&&t.forEach((t,r,i)=>{t.innerText=e.times+1,n&&(n.style.display="inline")})});t.push(s);var o=document.querySelector("#lc-uv"),a=this.getRecord(e,"https://shiraha.cn/#lc-uv","Visitors").then(e=>{var t=this.validUV();t&&r.push(this.buildIncrement(e.objectId));var n=document.querySelectorAll("#lc-uv #number");n.length>0&&n.forEach((r,n,i)=>{r.innerText=e.times+(t?1:0),o&&(o.style.display="inline")})});t.push(a);var l=document.querySelectorAll("#lc-pv");for(l.length,i=0;i<l.length;i++){let n=l[i],s=n.getAttribute("data-title");var h="https://shiraha.cn"+n.getAttribute("data-path");if(h){var c=this.getRecord(e,h,s).then(e=>{let t=window.location.pathname;if(t.includes("index.html")&&(t=t.substring(0,t.lastIndexOf("index.html"))),n.getAttribute("data-path")==t&&r.push(this.buildIncrement(e.objectId)),n){var i=n.querySelector("#lc-pv #number");i&&(n.getAttribute("data-path")==t?i.innerText=(e.times||0)+1:i.innerText=e.times||0,n.style.display="inline")}});t.push(c)}}Promise.all(t).then(()=>{r.length>0&&this.increment(e,r)})},fetchData(e){this.addCount((t,r,n)=>fetch(`${e}/1.1${r}`,{method:t,headers:{"X-LC-Id":this.app_id,"X-LC-Key":this.app_key,"Content-Type":"application/json"},body:JSON.stringify(n)}))},refreshCounter(){var e="-MdYXbMMI"!==this.app_id.slice(-9)?this.custom_api_server:`https://${this.app_id.slice(0,8).toLowerCase()}.api.lncldglobal.com`;e?this.fetchData(e):fetch("https://app-router.leancloud.cn/2/route?appId="+this.app_id).then(e=>e.json()).then(({api_server:e})=>{this.fetchData("https://"+e)})}};LCCounter.refreshCounter(),document.addEventListener("pjax:complete",(function(){LCCounter.refreshCounter()}))</script><script>var imgs=["https://7.dusays.com/2021/04/17/8684a996f98bc.png","https://7.dusays.com/2021/02/12/af09d405c91ec.png","https://7.dusays.com/2021/02/12/e87cab65e7775.png","https://7.dusays.com/2021/02/12/8f20463ff67c1.png","https://7.dusays.com/2021/02/10/78789d247317f.png","https://7.dusays.com/2021/02/12/ffd190bb54398.png","https://7.dusays.com/2021/02/12/b452f9344b8f4.png"],index=0;function shuffle(a){for(var l=a.length;l--;){var e=Math.floor(Math.random()*l),r=a[e];a[e]=a[l],a[l]=r}}function parallax(a){$("#parallax-window").parallax({src:a,speed:.25,bleed:0,zIndex:-100,posX:"center",posY:"center",overScrollFix:!1,excludeAgents:/(iPod|iPhone|iPad|Android)/,aspectRatio:null,sliderSelector:">.parallax-slider",mirrorSelector:"#l_cover",afterRefresh:()=>{},afterRender:()=>{},afterSetup:()=>{},afterDestroy:()=>{}})}function next_parallax(){$("#l_cover .parallax-mirror img")[0].src=imgs[index%imgs.length],index++,fetch(imgs[index%imgs.length])}function pjax_parallax(){next_parallax(),volantis.IntervalParallax=setInterval((function(){next_parallax()}),15e3)}shuffle(imgs),loadScript("/js/jquery.parallax.min.js");var checkParallax=setInterval((function(){"block"==$("#safearea").css("display")&&void 0!==$("#parallax-window").parallax&&(clearInterval(checkParallax),parallax(imgs[index%imgs.length]))}),500);volantis.pjax.push(pjax_parallax),volantis.pjax.send(()=>{try{clearInterval(volantis.IntervalParallax)}catch(a){}},"pjax_parallax")</script><script>volantis.message=(s,e,a,o)=>{if(void 0===$.message){loadCSS("/css/message.css"),loadScript("/js/message.js",()=>{t(s,e,a,o)})}else t(s,e,a,o);function t(s,e,a,o){$.message({title:s,message:e,type:a,autoClose:o})}}</script><script>function listennSidebarTOC(){const e=document.querySelectorAll(".toc li");if(!e.length)return;const t=[...e].map(e=>{const t=e.querySelector(".toc-link"),n=document.getElementById(decodeURI(t.getAttribute("href")).replace("#",""));return t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:n.offsetTop+100,behavior:"smooth"})}),n});!function n(o){o=Math.floor(o+1e4);let r=new IntersectionObserver((r,c)=>{let i=document.documentElement.scrollHeight+100;if(i>o)return c.disconnect(),void n(i);let l=function(e){let n=0,o=e[n];if(o.boundingClientRect.top>0)return n=t.indexOf(o.target),0===n?0:n-1;for(;n<e.length;n++){if(!(e[n].boundingClientRect.top<=0))return t.indexOf(o.target);o=e[n]}return t.indexOf(o.target)}(r);!function(e){if(e.classList.contains("active-current"))return;document.querySelectorAll(".toc .active").forEach(e=>{e.classList.remove("active","active-current")}),e.classList.add("active","active-current");let t=e.parentNode;for(;!t.matches(".toc");)t.matches("li")&&t.classList.add("active"),t=t.parentNode}(e[l])},{rootMargin:o+"px 0px -100% 0px",threshold:0});t.forEach(e=>{e&&r.observe(e)})}(document.documentElement.scrollHeight)}document.addEventListener("DOMContentLoaded",listennSidebarTOC),document.addEventListener("pjax:success",listennSidebarTOC)</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>var pjax;document.addEventListener("DOMContentLoaded",(function(){pjax=new Pjax({elements:'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',selectors:["title","#pjax-container","#pjax-header-nav-list"],cacheBust:!1,timeout:5e3})})),document.addEventListener("pjax:send",(function(t){try{var e=window.location.pathname,a=t.triggerElement.href,n=["/artitalk/","/bb/","/toys/spa"];""!=n[0]&&n.forEach(t=>{-1==e.indexOf(t)&&-1==a.indexOf(t)||(window.location.href=a)})}catch(t){}volantis.pjax.method.send.start()})),document.addEventListener("pjax:complete",(function(){$("script[data-pjax], .pjax-reload script").each((function(){$(this).parent().append($(this).remove())})),volantis.pjax.method.complete.start()})),document.addEventListener("pjax:error",(function(t){volantis.pjax.method.error.start(),window.location.href=t.triggerElement.href}))</script></div></body></html>